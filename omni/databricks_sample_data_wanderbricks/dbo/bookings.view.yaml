# Reference this view as bookings
schema: dbo

dimensions:
  booking_id:
    format: ID
    description: Unique identifier of the booking
    primary_key: true

  user_id:
    format: ID
    description: The identifier of the user making the booking

  property_id:
    format: ID
    description: Foreign Key to 'properties'
    required_access_grants: [ dev_views ]

  check_in:
    description: Check-in date

  check_out:
    description: Check-out date

  guests_count:
    description: Number of guests for booking

  total_amount:
    description: amount paid for this booking

  status:
    description: Status of the booking (e.g., pending, confirmed)

  created_at:
    description: Date the booking was created

  updated_at:
    description: Date the booking was last updated

measures:
  booking_count:
    aggregate_type: count

  booking_amount:
    sql: ${total_amount}
    description: Total amount paid
    aggregate_type: sum

  avg_booking_amount:
    sql: ${booking_amount}/${booking_count}

  average_amount:
    sql: CASE WHEN ${bookings.booking_count} = 0 THEN NULL ELSE
      COALESCE(${bookings.booking_amount}, 0) / ${bookings.booking_count} END
    label: Average Amount
